<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán ƒê·ªçc Hi·ªÉu: Tourism (T∆∞ Duy S√¢u)</title>
    <style>
        :root {
            --primary-color: #0369a1; /* Xanh bi·ªÉn ƒë·∫≠m */
            --bg-color: #f8fafc;
            --text-color: #334155;
            --highlight-yellow: #fde047;
            --highlight-user: #fca5a5;
            --correct-color: #15803d;
            --wrong-color: #b91c1c;
            --sidebar-width: 140px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0; background-color: var(--bg-color);
            height: 100vh; display: flex; flex-direction: column; color: var(--text-color);
        }

        .container { display: flex; flex: 1; height: 100%; overflow: hidden; }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width); background: white; border-right: 1px solid #e2e8f0;
            display: flex; flex-direction: column; padding: 15px 10px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05); z-index: 20;
        }
        .q-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .q-btn {
            width: 100%; padding: 12px 5px; border: 1px solid #e2e8f0;
            border-radius: 8px; cursor: pointer; background: white;
            font-weight: 600; font-size: 0.9rem; color: #64748b; text-align: center;
            transition: all 0.2s;
        }
        .q-btn:hover { background-color: #f1f5f9; border-color: #94a3b8; }
        .q-btn.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); box-shadow: 0 4px 6px -1px rgba(3, 105, 161, 0.3); }
        .q-btn.completed { border-color: var(--correct-color); background-color: #dcfce7; color: var(--correct-color); }
        
        .submit-btn {
            margin-top: 15px; padding: 12px; background: #ea580c; color: white;
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
            text-transform: uppercase; font-size: 0.9rem; letter-spacing: 0.5px;
            box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.4);
        }
        .submit-btn:hover { background: #c2410c; transform: translateY(-1px); }

        /* READING CONTENT */
        .reading-content {
            flex: 1; background: white; padding: 40px 60px; overflow-y: auto;
            border-right: 1px solid #e2e8f0; line-height: 1.9; font-size: 1.15rem;
            position: relative; scroll-behavior: smooth;
        }
        .reading-content h2 { color: #0f172a; margin-top: 0; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; }
        .reading-content p { margin-bottom: 25px; text-align: justify; }
        
        .system-highlight { 
            background-color: var(--highlight-yellow); border-radius: 4px; 
            box-shadow: 0 0 0 3px var(--highlight-yellow); transition: background 0.3s; 
        }
        
        .my-vocab-mark {
            background-color: var(--highlight-user); border-bottom: 2px solid #ef4444;
            cursor: pointer; padding: 0 2px; border-radius: 3px; position: relative;
        }
        .my-vocab-mark:hover::after {
            content: attr(title); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            background: #333; color: #fff; padding: 4px 8px; border-radius: 4px;
            font-size: 0.8rem; white-space: nowrap; pointer-events: none; z-index: 10;
        }

        /* Tooltip */
        .selection-tooltip {
            position: absolute; display: none; background: #1e293b; color: white; 
            padding: 8px 12px; border-radius: 6px; font-size: 0.9rem; cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3); z-index: 100;
            animation: fadeIn 0.2s; user-select: none;
        }
        .selection-tooltip:hover { background: #334155; }
        .selection-tooltip::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -6px;
            border-width: 6px; border-style: solid; border-color: #1e293b transparent transparent transparent;
        }

        /* QUESTION PANEL */
        .question-panel {
            width: 420px; min-width: 380px; background: #f8fafc; padding: 25px;
            display: flex; flex-direction: column; overflow-y: auto; border-left: 1px solid #e2e8f0;
        }
        .question-card { 
            background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; 
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #e2e8f0;
        }
        .q-header { font-size: 0.85rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .q-text { font-weight: 600; font-size: 1.1rem; margin-bottom: 20px; color: #1e293b; }

        .options-grid { display: flex; flex-direction: column; gap: 10px; }
        .option-btn { 
            padding: 12px 16px; border: 1px solid #cbd5e1; border-radius: 8px; 
            cursor: pointer; background: white; text-align: left; font-size: 1rem; color: #475569;
            transition: all 0.2s;
        }
        .option-btn:hover { background-color: #f1f5f9; border-color: #64748b; }
        .option-btn.correct { background-color: #dcfce7; border-color: var(--correct-color); color: #15803d; font-weight: 700; }
        .option-btn.wrong { background-color: #fee2e2; border-color: var(--wrong-color); color: #b91c1c; opacity: 0.8; }

        /* Hints Steps */
        .hint-container { display: flex; flex-direction: column; gap: 10px; }
        .hint-step { background: white; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        .hint-header { 
            padding: 12px 15px; background: #fff; cursor: pointer; 
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600; font-size: 0.95rem; color: #475569;
        }
        .hint-header:hover { background: #f8fafc; }
        
        .hint-step:nth-child(1) .hint-header { border-left: 4px solid #3b82f6; } /* Xanh */
        .hint-step:nth-child(2) .hint-header { border-left: 4px solid #f59e0b; } /* Cam */
        .hint-step:nth-child(3) .hint-header { border-left: 4px solid #8b5cf6; } /* T√≠m */
        .hint-step:nth-child(4) .hint-header { border-left: 4px solid #10b981; } /* Xanh l√° */

        .hint-body { 
            padding: 15px; display: none; border-top: 1px solid #f1f5f9; 
            color: #334155; font-size: 0.95rem; background-color: #fcfcfc; line-height: 1.6;
        }
        .hint-step.active .hint-body { display: block; animation: slideDown 0.2s; }
        .translate-box { margin-top: 10px; padding: 10px; background-color: #ecfdf5; border: 1px dashed #10b981; border-radius: 6px; color: #065f46; font-size: 0.95rem; }

        /* User Vocab Panel */
        .user-vocab-panel { margin-top: 20px; background: #fff1f2; border: 1px dashed #f43f5e; padding: 15px; border-radius: 12px; }
        .vocab-item-row { display: flex; justify-content: space-between; font-size: 0.9rem; border-bottom: 1px solid #ffe4e6; padding: 8px 0; }
        .del-btn { color: #f43f5e; cursor: pointer; font-weight: bold; padding: 0 5px; }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; width: 600px; max-height: 85vh; border-radius: 16px;
            padding: 40px; overflow-y: auto; position: relative; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <div class="q-list" id="sidebarList"></div>
        <button class="submit-btn" onclick="submitQuiz()">N·ªôp b√†i</button>
    </div>

    <div class="reading-content" id="readingText">
        <div id="vocabTooltip" class="selection-tooltip" onmousedown="event.preventDefault()" onclick="saveSelectedVocab()">
            ‚ú® D·ªãch & L∆∞u
        </div>

        <h2>Tourism: A Fast-Growing Industry</h2>
        <p style="font-size: 0.9rem; color: #64748b; font-style: italic; background: #f8fafc; padding: 10px; border-radius: 6px;">
            üí° <strong>M·∫πo hay:</strong> B√¥i ƒëen t·ª´ v·ª±ng ƒë·ªÉ xem nghƒ©a ti·∫øng Vi·ªát t·ª± ƒë·ªông.
        </p>
        
        <p id="para1">
            <span id="p1-main">Tourism is one of the fastest-growing industries in the world.</span> Millions of people travel every year to explore new places, learn about different cultures, or simply relax. There are many types of tourism, such as cultural tourism, eco-tourism, and adventure tourism. Each type offers unique experiences. <span id="p1-cultural">For example, <strong>cultural tourism</strong> involves visiting museums, temples, or historical sites to learn about a country's history and traditions.</span>
        </p>

        <p id="para2">
            <span id="p2-intro">Many people also enjoy <strong>natural attractions</strong>, such as beaches, mountains, or national parks.</span> <span id="p2-these"><strong>These</strong> places allow tourists to relax and enjoy outdoor activities like swimming, hiking, or camping.</span> However, as more people visit these natural sites, problems such as pollution and overcrowding can occur. <span id="p2-eco">To address these issues, <strong>eco-tourism encourages</strong> people to travel in a way that protects the environment.</span> Eco-tourism focuses on small groups, respects nature, and supports local communities.
        </p>

        <p id="para3">
            Tourism has a positive impact on local economies. It creates jobs in hotels, restaurants, and transportation services. Small businesses also benefit from tourists buying souvenirs and local products. <span id="p3-important">However, it is <strong>important</strong> to plan tourism carefully to avoid damaging local culture or natural environments.</span>
        </p>

        <p id="para4">
            Planning a trip well can make a big difference. Before traveling, tourists often research the weather, costs, and the best activities to do. A good plan helps ensure a fun and safe experience for everyone.
        </p>
    </div>

    <div class="question-panel">
        <div id="questionContainer"></div>
        
        <div class="user-vocab-panel" id="userVocabPanel" style="display:none;">
            <h4 style="margin:0 0 10px 0; color:#be123c; display:flex; align-items:center; gap:5px;">
                üìí T·ª´ v·ª±ng c·ªßa t√¥i <span style="font-size:0.8rem; font-weight:normal; color:#881337;" id="vocabCount">(0)</span>
            </h4>
            <div id="userVocabList" style="display: flex; flex-direction: column;"></div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="resultModal">
    <div class="modal-content">
        <div style="text-align: center; border-bottom: 2px dashed #e2e8f0; padding-bottom: 25px; margin-bottom: 25px;">
            <h2 style="margin:0; color: var(--primary-color);">üéâ T·ªïng K·∫øt B√†i L√†m</h2>
            <div style="font-size: 3rem; font-weight: 800; color: var(--primary-color); margin: 10px 0;" id="scoreText">0/6</div>
            <p style="color: #64748b;">B·∫°n ƒë√£ ho√†n th√†nh b√†i luy·ªán t·∫≠p.</p>
        </div>

        <div>
            <h3 style="background:#fff1f2; color:#be123c; padding:10px 15px; border-radius:8px; display:inline-block; margin-top:0;">
                üìí Danh s√°ch t·ª´ v·ª±ng b·∫°n ƒë√£ l∆∞u
            </h3>
            <div id="finalVocabGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;"></div>
            <p id="noVocabMsg" style="color:#64748b; font-style:italic; display:none; text-align:center;">B·∫°n ch∆∞a ƒë√°nh d·∫•u t·ª´ v·ª±ng n√†o.</p>
        </div>

        <button style="display:block; width:100%; margin-top:30px; padding:15px; background:var(--text-color); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1rem;" onclick="closeModal()">
            ƒê√≥ng v√† Xem l·∫°i b√†i l√†m
        </button>
    </div>
</div>

<script>
    // --- T·ª™ ƒêI·ªÇN T√çCH H·ª¢P (BUILT-IN DICTIONARY) ---
    const builtInDict = {
        "tourism": "Du l·ªãch",
        "fastest-growing": "Ph√°t tri·ªÉn nhanh nh·∫•t",
        "industry": "Ng√†nh c√¥ng nghi·ªáp",
        "industries": "C√°c ng√†nh c√¥ng nghi·ªáp",
        "explore": "Kh√°m ph√°",
        "cultures": "C√°c n·ªÅn vƒÉn h√≥a",
        "relax": "Th∆∞ gi√£n",
        "cultural tourism": "Du l·ªãch vƒÉn h√≥a",
        "eco-tourism": "Du l·ªãch sinh th√°i",
        "adventure tourism": "Du l·ªãch m·∫°o hi·ªÉm",
        "unique experiences": "Tr·∫£i nghi·ªám ƒë·ªôc ƒë√°o",
        "museums": "B·∫£o t√†ng",
        "temples": "ƒê·ªÅn ch√πa",
        "historical sites": "Di t√≠ch l·ªãch s·ª≠",
        "traditions": "Truy·ªÅn th·ªëng",
        "natural attractions": "ƒêi·ªÉm du l·ªãch t·ª± nhi√™n",
        "beaches": "B√£i bi·ªÉn",
        "mountains": "N√∫i",
        "national parks": "C√¥ng vi√™n qu·ªëc gia",
        "outdoor activities": "Ho·∫°t ƒë·ªông ngo√†i tr·ªùi",
        "hiking": "ƒêi b·ªô ƒë∆∞·ªùng d√†i/Leo n√∫i",
        "camping": "C·∫Øm tr·∫°i",
        "pollution": "√î nhi·ªÖm",
        "overcrowding": "Qu√° ƒë√¥ng ƒë√∫c",
        "occur": "X·∫£y ra",
        "address": "Gi·∫£i quy·∫øt (v·∫•n ƒë·ªÅ)",
        "encourages": "Khuy·∫øn kh√≠ch",
        "protects": "B·∫£o v·ªá",
        "environment": "M√¥i tr∆∞·ªùng",
        "local communities": "C·ªông ƒë·ªìng ƒë·ªãa ph∆∞∆°ng",
        "positive impact": "T√°c ƒë·ªông t√≠ch c·ª±c",
        "local economies": "Kinh t·∫ø ƒë·ªãa ph∆∞∆°ng",
        "transportation services": "D·ªãch v·ª• v·∫≠n chuy·ªÉn",
        "benefit": "H∆∞·ªüng l·ª£i",
        "souvenirs": "Qu√† l∆∞u ni·ªám",
        "local products": "S·∫£n ph·∫©m ƒë·ªãa ph∆∞∆°ng",
        "important": "Quan tr·ªçng",
        "carefully": "C·∫©n th·∫≠n",
        "damaging": "G√¢y h·∫°i",
        "planning": "L·∫≠p k·∫ø ho·∫°ch",
        "research": "Nghi√™n c·ª©u/T√¨m hi·ªÉu",
        "weather": "Th·ªùi ti·∫øt",
        "costs": "Chi ph√≠",
        "ensure": "ƒê·∫£m b·∫£o",
        "safe experience": "Tr·∫£i nghi·ªám an to√†n"
    };

    // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (C·∫≠p nh·∫≠t T∆∞ Duy S√¢u & Scaffolding) ---
    const quizData = [
        {
            id: 25,
            questionText: "What is the passage mainly about?",
            options: { A: "How to plan a perfect trip.", B: "Different types of tourism and their impacts.", C: "The best tourist attractions in the world.", D: "The challenges of tourist" },
            correct: "B",
            relatedSentenceId: "p1-main", 
            hints: {
                step1: "<strong>Ph√¢n lo·∫°i:</strong> C√¢u h·ªèi √ù ch√≠nh (Main Idea).<br><strong>Chi·∫øn thu·∫≠t:</strong> N√™n l√†m c√¢u n√†y cu·ªëi c√πng sau khi ƒë√£ hi·ªÉu s∆° b·ªô b√†i ƒë·ªçc.",
                step2: "<strong>ƒê·ªãnh v·ªã th√¥ng tin:</strong> H√£y ƒë·ªçc c√¢u m·ªü ƒë·∫ßu (Topic Sentence) c·ªßa ƒêo·∫°n 1, ƒêo·∫°n 2 v√† ƒêo·∫°n 3.<br><em>(B·∫•m v√†o ƒë√¢y ƒë·ªÉ xem v·ªã tr√≠ c√°c c√¢u n√†y)</em>",
                step3: "<strong>T∆∞ duy & Suy lu·∫≠n:</strong><br>- ƒêo·∫°n 1 li·ªát k√™ c√°c c√°i g√¨ c·ªßa du l·ªãch? (C√≥ n√≥i ƒë·∫øn eco, cultural... g·ªçi chung l√† g√¨?)<br>- ƒêo·∫°n 2 v√† 3 b√†n v·ªÅ v·∫•n ƒë·ªÅ g√¨ li√™n quan ƒë·∫øn m√¥i tr∆∞·ªùng v√† kinh t·∫ø? (L√† ƒëi·ªÅu t·ªët hay x·∫•u, hay bao g·ªìm c·∫£ hai?)<br>- H√£y th·ª≠ xem x√©t ph·∫°m vi: B√†i vi·∫øt c√≥ ch·ªâ n√≥i ri√™ng v·ªÅ vi·ªác 'l·∫≠p k·∫ø ho·∫°ch' kh√¥ng? Hay ch·ªâ n√≥i v·ªÅ 'th·ª≠ th√°ch' th√¥i?",
                step4: "<strong>K·∫øt lu·∫≠n & D·ªãch:</strong><br>- Ch·ªçn ƒë√°p √°n <strong>B</strong>.<br>- L√Ω do: B√†i vi·∫øt bao qu√°t c·∫£ c√°c lo·∫°i h√¨nh (types) ·ªü ƒëo·∫°n 1 v√† t√°c ƒë·ªông (impacts - t√≠ch c·ª±c v√† ti√™u c·ª±c) ·ªü ƒëo·∫°n 2, 3.<br><div class='translate-box'><strong>D·ªãch:</strong> Du l·ªãch l√† m·ªôt trong nh·ªØng ng√†nh c√¥ng nghi·ªáp ph√°t tri·ªÉn nhanh nh·∫•t th·∫ø gi·ªõi... Du l·ªãch c√≥ t√°c ƒë·ªông t√≠ch c·ª±c ƒë·∫øn kinh t·∫ø ƒë·ªãa ph∆∞∆°ng.</div>"
            }
        },
        {
            id: 26,
            questionText: "What does the word \"these\" in paragraph 2 refer to?",
            options: { A: "Museums and temples", B: "Natural attractions", C: "Local communities", D: "Tourist groups" },
            correct: "B",
            relatedSentenceId: "p2-intro", 
            hints: {
                step1: "<strong>Ph√¢n lo·∫°i:</strong> C√¢u h·ªèi Quy chi·∫øu (Reference).<br><strong>T·ª´ kh√≥a:</strong> \"these\" (·ªü ƒëo·∫°n 2).",
                step2: "<strong>ƒê·ªãnh v·ªã th√¥ng tin:</strong> T√¨m t·ª´ \"These\" trong ƒëo·∫°n 2. Sau ƒë√≥ nh√¨n v√†o c√¢u n·∫±m NGAY TR∆Ø·ªöC n√≥.",
                step3: "<strong>T∆∞ duy & Suy lu·∫≠n:</strong><br>- Trong ng·ªØ ph√°p, t·ª´ 'these' (nh·ªØng c√°i n√†y) d√πng ƒë·ªÉ thay th·∫ø cho m·ªôt danh t·ª´ s·ªë nhi·ªÅu v·ª´a ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn ƒë·ªÉ tr√°nh l·∫∑p t·ª´.<br>- H√£y quan s√°t c√¢u ph√≠a tr∆∞·ªõc: T√°c gi·∫£ ƒëang li·ªát k√™ nh·ªØng ƒë·ªãa danh n√†o (bi·ªÉn, n√∫i...)? C·ª•m danh t·ª´ n√†o bao qu√°t c√°c ƒë·ªãa danh ƒë√≥?",
                step4: "<strong>K·∫øt lu·∫≠n & D·ªãch:</strong><br>- Ch·ªçn ƒë√°p √°n <strong>B</strong>.<br>- L√Ω do: 'These places' thay th·∫ø cho 'Natural attractions' ·ªü c√¢u tr∆∞·ªõc.<br><div class='translate-box'><strong>D·ªãch:</strong> Nhi·ªÅu ng∆∞·ªùi c≈©ng th√≠ch c√°c ƒëi·ªÉm du l·ªãch t·ª± nhi√™n, nh∆∞ b√£i bi·ªÉn, n√∫i non ho·∫∑c c√°c c√¥ng vi√™n qu·ªëc gia.</div>"
            }
        },
        {
            id: 27,
            questionText: "The word \"encourages\" in paragraph 2 is CLOSEST in meaning to:",
            options: { A: "teaches", B: "demands", C: "changes", D: "supports" },
            correct: "D",
            relatedSentenceId: "p2-eco",
            hints: {
                step1: "<strong>Ph√¢n lo·∫°i:</strong> T·ª´ v·ª±ng (ƒê·ªìng nghƒ©a/G·∫ßn nghƒ©a).<br><strong>T·ª´ kh√≥a:</strong> \"encourages\".",
                step2: "<strong>ƒê·ªãnh v·ªã th√¥ng tin:</strong> T√¨m c√¢u ch·ª©a c·ª•m \"eco-tourism encourages people...\" trong ƒëo·∫°n 2.",
                step3: "<strong>T∆∞ duy & Suy lu·∫≠n:</strong><br>- H√£y x√©t ng·ªØ c·∫£nh: M·ª•c ti√™u c·ªßa du l·ªãch sinh th√°i l√† b·∫£o v·ªá m√¥i tr∆∞·ªùng.<br>- H√†nh ƒë·ªông n√†y mang s·∫Øc th√°i t√≠ch c·ª±c (ƒë·ªông vi√™n/ti·∫øp s·ª©c) hay ti√™u c·ª±c (b·∫Øt √©p)?<br>- Trong c√°c t·ª´ ng·ªØ g·ª£i √Ω, t·ª´ n√†o th·ªÉ hi·ªán vi·ªác ƒë·ª©ng sau th√∫c ƒë·∫©y ho·∫∑c ·ªßng h·ªô m·ªôt h√†nh ƒë·ªông t·ªët?",
                step4: "<strong>K·∫øt lu·∫≠n & D·ªãch:</strong><br>- Ch·ªçn ƒë√°p √°n <strong>D (supports)</strong>.<br>- L√Ω do: 'Encourage' (khuy·∫øn kh√≠ch) mang nghƒ©a t∆∞∆°ng ƒë·ªìng v·ªõi vi·ªác ·ªßng h·ªô/h·ªó tr·ª£.<br><div class='translate-box'><strong>D·ªãch:</strong> ƒê·ªÉ gi·∫£i quy·∫øt nh·ªØng v·∫•n ƒë·ªÅ n√†y, du l·ªãch sinh th√°i khuy·∫øn kh√≠ch m·ªçi ng∆∞·ªùi ƒëi du l·ªãch theo c√°ch b·∫£o v·ªá m√¥i tr∆∞·ªùng.</div>"
            }
        },
        {
            id: 28,
            questionText: "The word \"important\" in paragraph 3 OPPOSITE in meaning to:",
            options: { A: "essential", B: "imperative", C: "insignificant", D: "weighty" },
            correct: "C",
            relatedSentenceId: "p3-important",
            hints: {
                step1: "<strong>Ph√¢n lo·∫°i:</strong> T·ª´ v·ª±ng (Tr√°i nghƒ©a).<br><strong>T·ª´ kh√≥a:</strong> \"OPPOSITE\" (Ng∆∞·ª£c l·∫°i) v√† \"important\".",
                step2: "<strong>ƒê·ªãnh v·ªã th√¥ng tin:</strong> T√¨m t·ª´ \"important\" trong ƒëo·∫°n 3.",
                step3: "<strong>T∆∞ duy & Suy lu·∫≠n:</strong><br>- ƒê·ªÅ b√†i t√¨m t·ª´ TR√ÅI NGHƒ®A v·ªõi 'quan tr·ªçng'. T·ª©c l√† ta c·∫ßn t√¨m m·ªôt t·ª´ mang nghƒ©a 'kh√¥ng quan tr·ªçng' ho·∫∑c 'nh·ªè nh·∫∑t'.<br>- H√£y quan s√°t c·∫•u t·∫°o t·ª´ (Word formation): C√≥ t·ª´ n√†o ch·ª©a ti·ªÅn t·ªë ph·ªß ƒë·ªãnh (nh∆∞ <em>un-, in-, dis-</em>) mang nghƒ©a l√† 'kh√¥ng' hay kh√¥ng?",
                step4: "<strong>K·∫øt lu·∫≠n & D·ªãch:</strong><br>- Ch·ªçn ƒë√°p √°n <strong>C (insignificant)</strong>.<br>- L√Ω do: Ti·ªÅn t·ªë 'in-' t·∫°o nghƒ©a ph·ªß ƒë·ªãnh cho t·ª´ significant (ƒë√°ng k·ªÉ/quan tr·ªçng).<br><div class='translate-box'><strong>D·ªãch:</strong> Tuy nhi√™n, vi·ªác l√™n k·∫ø ho·∫°ch du l·ªãch c·∫©n th·∫≠n ƒë·ªÉ tr√°nh l√†m t·ªïn h·∫°i vƒÉn h√≥a ƒë·ªãa ph∆∞∆°ng l√† r·∫•t quan tr·ªçng.</div>"
            }
        },
        {
            id: 29,
            questionText: "Which of the following is TRUE, according to the passage?",
            options: { A: "All tourists prefer beaches to museums.", B: "Tourism always damages local culture.", C: "Eco-tourism focuses on protecting nature.", D: "Tourists rarely spend money on souvenirs." },
            correct: "C",
            relatedSentenceId: "p2-eco",
            hints: {
                step1: "<strong>Ph√¢n lo·∫°i:</strong> C√¢u h·ªèi ƒê√∫ng/Sai (True/False).<br><strong>Chi·∫øn thu·∫≠t:</strong> C·∫©n tr·ªçng v·ªõi c√°c t·ª´ ch·ªâ s·ª± tuy·ªát ƒë·ªëi (All, Always, Rarely).",
                step2: "<strong>ƒê·ªãnh v·ªã th√¥ng tin:</strong> Qu√©t nhanh b√†i ƒë·ªçc ƒë·ªÉ t√¨m c√°c t·ª´ kh√≥a li√™n quan ƒë·∫øn 'Eco-tourism', 'Souvenirs', 'Culture'.",
                step3: "<strong>T∆∞ duy & Suy lu·∫≠n:</strong><br>- Logic lo·∫°i tr·ª´: C√≥ bao gi·ªù 'T·∫•t c·∫£' (All) du kh√°ch ƒë·ªÅu th√≠ch m·ªôt th·ª© gi·ªëng nhau kh√¥ng? Du l·ªãch c√≥ 'Lu√¥n lu√¥n' (Always) g√¢y h·∫°i kh√¥ng hay ch·ªâ khi thi·∫øu k·∫ø ho·∫°ch?<br>- Ki·ªÉm ch·ª©ng th√¥ng tin: ƒêo·∫°n vƒÉn n√≥i m·ª•c ƒë√≠ch ch√≠nh c·ªßa 'eco-tourism' l√† g√¨? N√≥ t·∫≠p trung v√†o ƒëi·ªÅu g√¨?",
                step4: "<strong>K·∫øt lu·∫≠n & D·ªãch:</strong><br>- Ch·ªçn ƒë√°p √°n <strong>C</strong>.<br>- L√Ω do: Kh·ªõp v·ªõi th√¥ng tin trong b√†i v·ªÅ m·ª•c ti√™u c·ªßa du l·ªãch sinh th√°i.<br><div class='translate-box'><strong>D·ªãch:</strong> Du l·ªãch sinh th√°i t·∫≠p trung v√†o c√°c nh√≥m nh·ªè, t√¥n tr·ªçng thi√™n nhi√™n v√† h·ªó tr·ª£ c·ªông ƒë·ªìng ƒë·ªãa ph∆∞∆°ng.</div>"
            }
        },
        {
            id: 30,
            questionText: "According to the passage, what is cultural tourism?",
            options: { A: "Visiting places to learn about history and traditions.", B: "Traveling to enjoy outdoor activities.", C: "Protecting the environment while traveling.", D: "Buying local products from small businesses." },
            correct: "A",
            relatedSentenceId: "p1-cultural",
            hints: {
                step1: "<strong>Ph√¢n lo·∫°i:</strong> C√¢u h·ªèi Chi ti·∫øt (Detail).<br><strong>T·ª´ kh√≥a:</strong> \"cultural tourism\".",
                step2: "<strong>ƒê·ªãnh v·ªã th√¥ng tin:</strong> T√¨m ch√≠nh x√°c c·ª•m t·ª´ \"cultural tourism\" trong ƒêo·∫°n 1.",
                step3: "<strong>T∆∞ duy & Suy lu·∫≠n:</strong><br>- ƒê·ªçc ph·∫ßn ƒë·ªãnh nghƒ©a ƒëi ngay sau c·ª•m t·ª´ ƒë√≥ (sau ch·ªØ 'involves').<br>- T√°c gi·∫£ li·ªát k√™ c√°c h√†nh ƒë·ªông c·ª• th·ªÉ n√†o? (thƒÉm b·∫£o t√†ng, ƒë·ªÅn ch√πa...).<br>- M·ª•c ƒë√≠ch c·ªßa c√°c h√†nh ƒë·ªông ƒë√≥ l√† ƒë·ªÉ t√¨m hi·ªÉu v·ªÅ c√°i g√¨?",
                step4: "<strong>K·∫øt lu·∫≠n & D·ªãch:</strong><br>- Ch·ªçn ƒë√°p √°n <strong>A</strong>.<br>- L√Ω do: Kh·ªõp th√¥ng tin v·ªÅ 'learn about... history and traditions'.<br><div class='translate-box'><strong>D·ªãch:</strong> V√≠ d·ª•, du l·ªãch vƒÉn h√≥a bao g·ªìm vi·ªác thƒÉm quan b·∫£o t√†ng, ƒë·ªÅn ch√πa, ho·∫∑c di t√≠ch l·ªãch s·ª≠ ƒë·ªÉ t√¨m hi·ªÉu v·ªÅ l·ªãch s·ª≠ v√† truy·ªÅn th·ªëng c·ªßa m·ªôt qu·ªëc gia.</div>"
            }
        }
    ];

    // --- VARIABLES ---
    let userVocabCollection = []; 
    let currentSelectionRange = null; 
    let currentQIndex = 0;
    let userResults = {}; 

    // --- INIT ---
    function init() {
        renderSidebar();
        loadQuestion(0);
    }

    // --- SIDEBAR & QUESTION UI ---
    function renderSidebar() {
        const sidebarList = document.getElementById('sidebarList');
        sidebarList.innerHTML = '';
        quizData.forEach((q, index) => {
            const btn = document.createElement('div');
            btn.className = `q-btn ${index === 0 ? 'active' : ''}`;
            btn.id = `q-btn-${index}`;
            btn.innerText = `C√¢u ${q.id}`;
            btn.onclick = () => loadQuestion(index);
            sidebarList.appendChild(btn);
        });
    }

    function loadQuestion(index) {
        currentQIndex = index;
        const q = quizData[index];
        
        document.querySelectorAll('.q-btn').forEach((b, i) => {
            b.classList.remove('active');
            if (i === index) b.classList.add('active');
        });
        
        document.querySelectorAll('.system-highlight').forEach(el => el.classList.remove('system-highlight'));

        const container = document.getElementById('questionContainer');
        const isAnswered = userResults.hasOwnProperty(index);
        
        container.innerHTML = `
            <div class="question-card">
                <div class="q-header">Question ${q.id}</div>
                <div class="q-text">${q.questionText}</div>
                <div class="options-grid">
                    ${Object.entries(q.options).map(([key, val]) => 
                        `<button class="option-btn" onclick="checkAnswer('${key}')" id="opt-${key}">
                            <strong>${key}.</strong> ${val}
                        </button>`
                    ).join('')}
                </div>
            </div>
            
            <div class="hint-container">
                ${renderHintStep(1, "B∆∞·ªõc 1: Ph√¢n t√≠ch & Ph√¢n lo·∫°i", q.hints.step1)}
                ${renderHintStep(2, "B∆∞·ªõc 2: ƒê·ªãnh v·ªã th√¥ng tin (Scanning)", q.hints.step2, true)}
                ${renderHintStep(3, "B∆∞·ªõc 3: T∆∞ duy & Suy lu·∫≠n (Scaffolding)", q.hints.step3)}
                ${renderHintStep(4, "B∆∞·ªõc 4: X√°c ƒë·ªãnh th√¥ng tin & K·∫øt lu·∫≠n", q.hints.step4)}
            </div>
        `;

        if (isAnswered) {
             const correctBtn = document.getElementById(`opt-${q.correct}`);
             if(correctBtn) correctBtn.classList.add('correct');
             document.querySelectorAll('.hint-step').forEach(el => el.classList.add('active'));
        }
    }

    function renderHintStep(step, title, content, isHighlight=false) {
        return `
            <div class="hint-step">
                <div class="hint-header" onclick="toggleHint(this, ${isHighlight})">
                    <span>${title}</span>
                    <span>‚ñº</span>
                </div>
                <div class="hint-body">${content}</div>
            </div>
        `;
    }

    function toggleHint(header, isHighlight) {
        const parent = header.parentElement;
        parent.classList.toggle('active');
        
        if(isHighlight) {
            const q = quizData[currentQIndex];
            const ids = q.relatedSentenceId.split(','); 
            ids.forEach(id => {
                const el = document.getElementById(id.trim());
                if(el) {
                    if (parent.classList.contains('active')) {
                        el.classList.add('system-highlight');
                        if(ids.length === 1) el.scrollIntoView({behavior:'smooth', block:'center'});
                    } else {
                        el.classList.remove('system-highlight');
                    }
                }
            });
        }
    }

    function checkAnswer(choice) {
        if(userResults.hasOwnProperty(currentQIndex)) return;
        const q = quizData[currentQIndex];
        const isCorrect = (choice === q.correct);
        userResults[currentQIndex] = isCorrect;
        
        const userBtn = document.getElementById(`opt-${choice}`);
        const correctBtn = document.getElementById(`opt-${q.correct}`);
        
        if (isCorrect) {
            userBtn.classList.add('correct');
        } else {
            userBtn.classList.add('wrong');
            correctBtn.classList.add('correct');
        }
        
        document.getElementById(`q-btn-${currentQIndex}`).classList.add('completed');
        const steps = document.querySelectorAll('.hint-step');
        steps[3].classList.add('active'); 
    }

    // --- LOGIC X·ª¨ L√ù T·ª™ V·ª∞NG TH√îNG MINH ---
    const readingArea = document.getElementById('readingText');
    const tooltip = document.getElementById('vocabTooltip');

    readingArea.addEventListener('mouseup', function() {
        const selection = window.getSelection();
        const text = selection.toString().trim();
        
        if (text.length > 0 && text.length < 80) {
            currentSelectionRange = selection.getRangeAt(0).cloneRange();
            
            const rect = currentSelectionRange.getBoundingClientRect();
            const containerRect = readingArea.getBoundingClientRect();
            
            tooltip.style.left = (rect.left + rect.width/2 - 50 - containerRect.left + 60) + 'px'; 
            tooltip.style.top = (rect.top - 45 - containerRect.top + 40) + 'px'; 
            tooltip.style.display = 'block';
        } else {
            tooltip.style.display = 'none';
        }
    });

    document.addEventListener('mousedown', function(e) {
        if (e.target.id !== 'vocabTooltip') {
            tooltip.style.display = 'none';
        }
    });

    function saveSelectedVocab() {
        if (!currentSelectionRange) return;
        
        const text = currentSelectionRange.toString().trim();
        if (!text) return;

        // 1. CHU·∫®N H√ìA T·ª™ (ƒë·ªÉ tra t·ª´ ƒëi·ªÉn d·ªÖ h∆°n)
        const lookupKey = text.toLowerCase().replace(/[.,]/g, ""); 
        
        // 2. T·ª∞ ƒê·ªòNG D·ªäCH
        let meaning = "";
        if (builtInDict[lookupKey]) {
            meaning = builtInDict[lookupKey];
        } else if (lookupKey.endsWith('s') && builtInDict[lookupKey.slice(0, -1)]) {
            meaning = builtInDict[lookupKey.slice(0, -1)];
        }

        // 3. H·ªòP THO·∫†I
        const userMeaning = prompt(
            meaning ? `ƒê√£ t√¨m th·∫•y nghƒ©a t·ª± ƒë·ªông! B·∫°n c√≥ mu·ªën l∆∞u kh√¥ng?` : `Ch∆∞a t√¨m th·∫•y nghƒ©a t·ª± ƒë·ªông cho "${text}". Vui l√≤ng nh·∫≠p:`, 
            meaning || ""
        );

        if (userMeaning === null) return; 

        // 4. L∆ØU
        userVocabCollection.push({ en: text, vi: userMeaning || "..." });

        const span = document.createElement('span');
        span.className = 'my-vocab-mark';
        span.textContent = text;
        span.title = userMeaning; 
        
        currentSelectionRange.deleteContents();
        currentSelectionRange.insertNode(span);
        
        updateVocabPanel();
        tooltip.style.display = 'none';
        window.getSelection().removeAllRanges();
        currentSelectionRange = null; 
    }

    function updateVocabPanel() {
        const panel = document.getElementById('userVocabPanel');
        const list = document.getElementById('userVocabList');
        const count = document.getElementById('vocabCount');
        
        if (userVocabCollection.length > 0) panel.style.display = 'block';
        else panel.style.display = 'none';

        count.innerText = `(${userVocabCollection.length})`;
        
        list.innerHTML = userVocabCollection.map((v, index) => `
            <div class="vocab-item-row">
                <span><strong>${v.en}</strong>: ${v.vi}</span>
                <span class="del-btn" onclick="removeVocab(${index})">√ó</span>
            </div>
        `).join('');
    }

    function removeVocab(index) {
        userVocabCollection.splice(index, 1);
        updateVocabPanel();
    }

    // --- SUBMIT ---
    function submitQuiz() {
        let correct = 0;
        for(let k in userResults) if(userResults[k]) correct++;
        
        document.getElementById('scoreText').innerText = `${correct}/${quizData.length}`;
        
        const grid = document.getElementById('finalVocabGrid');
        const msg = document.getElementById('noVocabMsg');
        
        if (userVocabCollection.length === 0) {
            grid.innerHTML = '';
            msg.style.display = 'block';
        } else {
            msg.style.display = 'none';
            grid.innerHTML = userVocabCollection.map(v => `
                <div style="background:#f8fafc; padding:10px; border-radius:6px; border:1px solid #e2e8f0;">
                    <div style="font-weight:bold; color:#334155;">${v.en}</div>
                    <div style="font-size:0.9rem; color:#64748b;">${v.vi}</div>
                </div>
            `).join('');
        }
        
        document.getElementById('resultModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
    }

    init();
</script>

</body>
</html>
